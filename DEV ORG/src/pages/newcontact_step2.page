<!-- page NewContact_Step2 (uses custom duplicatePreventionWizardController) -->
<apex:page standardController="Contact" extensions="duplicatePreventionWizardController">
<!-- include postmessage JavaScript plugin -->
<script type="text/javascript" src="http://postmessage.freebaseapps.com/postmessage.js"></script>
<apex:form id="mainForm">
<!-- panel displaying error messages -->
<apex:outputPanel id="messages">
<apex:messages style="font-weight:bold; color:red;"/>
</apex:outputPanel>
<script>
// function handles events generated by Duplicate Prevention control
function handleEvent(data) {
switch(data['action']) {
case 'ON_LOAD':
if (data['duplicatesFound'] == 'false') {
// if duplicates are not found proceed with save
continueSave();
}
break;
case 'ON_OPEN':
// try to find and open Contact using id passed in event
openMatchedRecord(data['id']);
break;
case 'ON_IMPORT':
// convert JSON string passed in event into JavaScript object
var record = eval('(' + data['record'] + ')');
// try to save and open Contact using data from Hub passed in event
importObject(record.Customer.FirstName, record.Customer.LastName);
break;
}
}
// register function handleEvent as handler for Duplicate Prevention events
function bindHandler() {
pm.bind("idd_pmc_event", function(data) {
handleEvent(data);
});
}
bindHandler();
</script>
<!-- JavaScript functions invoking methods defined in controller, used by code handling events -->
<apex:actionFunction name="openMatchedRecord" action="{!openMatch}" reRender="messages">
<apex:param name="matchedRecordId" assignTo="{!matchedRecordId}" value=""/>
</apex:actionFunction>
<apex:actionFunction name="importObject" action="{!importObject}" reRender="messages">
<apex:param name="firstName" assignTo="{!importedFirstName}" value=""/>
<apex:param name="lastName" assignTo="{!importedLastName}" value=""/>
</apex:actionFunction>
<apex:actionFunction name="continueSave" action="{!save}" reRender="mainForm"/>
<apex:pageBlock id="mainPanel">
<apex:pageBlockButtons >
<!-- Skip button invokes standard save action -->
<apex:commandButton action="{!save}" value="Skip" immediate="true"/>
<!-- Cancel button redirects user to the first page -->
<apex:commandButton action="{!returnToEdit}" value="Cancel" immediate="true"/>
</apex:pageBlockButtons>
<apex:pageBlockSection title="Contact Information">
<apex:outputField value="{!contact.firstName}"/>
<apex:outputField value="{!contact.lastName}"/>
</apex:pageBlockSection>
<!-- IFRAME embedding Duplicate Prevention control, URL is constructed using string generated
by controller -->
<iframe src="http://host:port/bdd/bdc/dp/sa:Customer,{!matchParametersString}/proactive_match/component.jsf" style="width:100%;height:500px">
</iframe>
</apex:pageBlock>
</apex:form>
</apex:page>